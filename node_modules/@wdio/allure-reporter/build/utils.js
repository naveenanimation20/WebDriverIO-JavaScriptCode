"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getErrorFromFailedTest = exports.tellReporter = exports.isMochaAllHooks = exports.isMochaEachHooks = exports.isEmpty = exports.getTestStatus = void 0;

var _process = _interopRequireDefault(require("process"));

var _compoundError = _interopRequireDefault(require("./compoundError"));

var _constants = require("./constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const getTestStatus = (test, config) => {
  if (config.framework === 'jasmine') {
    return _constants.testStatuses.FAILED;
  }

  if (test.error.name) {
    return test.error.name === 'AssertionError' ? _constants.testStatuses.FAILED : _constants.testStatuses.BROKEN;
  }

  if (test.error.stack) {
    const stackTrace = test.error.stack.trim();
    return stackTrace.startsWith('AssertionError') ? _constants.testStatuses.FAILED : _constants.testStatuses.BROKEN;
  }

  return _constants.testStatuses.BROKEN;
};

exports.getTestStatus = getTestStatus;

const isEmpty = object => !object || Object.keys(object).length === 0;

exports.isEmpty = isEmpty;

const isMochaEachHooks = title => _constants.mochaEachHooks.some(hook => title.includes(hook));

exports.isMochaEachHooks = isMochaEachHooks;

const isMochaAllHooks = title => _constants.mochaAllHooks.some(hook => title.includes(hook));

exports.isMochaAllHooks = isMochaAllHooks;

const tellReporter = (event, msg = {}) => {
  _process.default.emit(event, msg);
};

exports.tellReporter = tellReporter;

const getErrorFromFailedTest = test => {
  if (test.errors && Array.isArray(test.errors)) {
    return test.errors.length === 1 ? test.errors[0] : new _compoundError.default(...test.errors);
  }

  return test.error;
};

exports.getErrorFromFailedTest = getErrorFromFailedTest;